<!DOCTYPE html>
<html lang="en">
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <!-- <link rel='stylesheet' type='text/css' href='https://cdn.rawgit.com/MarsUniversity/ece387/master/website/pandoc.css'> -->
      <script src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js?config=TeX-MML-AM_CHTML'></script>
    	<link href="https://cdnjs.cloudflare.com/ajax/libs/cc-icons/1.2.1/css/cc-icons.min.css" rel="stylesheet">
    	<link href="https://cdn.rawgit.com/walchko/font-linux/v0.7.2/assets/font-linux.css" rel="stylesheet">
      <!-- <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.0/build/pure-min.css" integrity="sha384-nn4HPE8lTHyVtfCBi5yW9d20FjT8BJwUXyWZT9InLYax14RDjBj46LmSztkmNP9w" crossorigin="anonymous"> -->
      <link href="https://fonts.googleapis.com/css?family=Source+Serif+Pro" rel="stylesheet">
      <link href="https://walchko.github.io/site.css" rel="stylesheet" type="text/css" />
      <!-- <link href="../../site.css" rel="stylesheet" type="text/css" /> -->
    	<!-- <link href="https://walchko.github.io/pygments.css" rel="stylesheet" type="text/css" /> -->
      <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [["$","$"],["\\(","\\)"]]
          }
        });
      </script>

	  <!-- code pulled from jupyter nbconvert for syntax coloring -->
	  <style type="text/css">
    .highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #888888 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0044DD } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mb { color: #666666 } /* Literal.Number.Bin */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sa { color: #BA2121 } /* Literal.String.Affix */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .dl { color: #BA2121 } /* Literal.String.Delimiter */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .fm { color: #0000FF } /* Name.Function.Magic */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .vm { color: #19177C } /* Name.Variable.Magic */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */
    </style>

    </head>
    <body>
      <div id="outer-wrapper">
        <div id="header-wrapper">
  <div class="title xtralarge bold"><a href="https://walchko.github.io/index.html">Planet Express</a></div>
  <div class="normal small"> Our crew is replaceable. Your package isn't. </div>

  <div class="nav normal">
    <a class="logo" href="https://walchko.github.io/index.html">Home</a>
    <a class="logo" href="https://walchko.github.io/colophon.html">Colophon</a>
    <a class="logo" href="https://walchko.github.io/about.html">About</a>
    <a class="logo" href="https://walchko.github.io/topics.html">Topics</a>
  </div>
</div>


          <div id="main">
            
            
              <h1 id="adafruit-i2s-mems-microphone-breakout">Adafruit I2S MEMS Microphone Breakout</h1>
<p><img src="pics/i2s-mic.jpg" /></p>
<p><a href="static/file.wav">Sample capture</a></p>
<h2 id="wiring">Wiring</h2>
<ul>
<li><strong>BCLK</strong>: the bit clock, also known as the data clock or just ‘clock’ - comes from the I2S master to tell the microphone its time to transmit data. This should run at 2-4 MHz but we’ve found you can often run it a little slower and it’ll work fine</li>
<li><strong>DOUT</strong>: the data output from the mic!</li>
<li><strong>LRCLK</strong>: the left/right clock, also known as WS (word select), this tells the mic when to start transmitting. When the LRCLK is low, the left channel will transmit. When LRCLK is high, the right channel will transmit.</li>
<li><strong>SEL</strong>: the channel select pin. By default this pin is low, so that it will transmit on the left channel mono. If you connect this to high logic voltage, the microphone will instantly start transmitting on the right channel.</li>
</ul>
<p><img src="pics/rpi-i2s-mic-mono.png" /></p>
<p>Setting on mic <code>SEL</code> pin HIGH and the other LOW will put them on different channels, either right or left.</p>
<p><img src="pics/rpi-i2s-mic-stereo.png" /></p>
<h2 id="alsa-setup">ALSA Setup</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="ex">pi@create</span> tmp $ cat ../.asoundrc</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="co">#This section makes a reference to your I2S hardware, adjust the card name</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3"><span class="co"># to what is shown in arecord -l after card x: before the name in []</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co">#You may have to adjust channel count also but stick with default first</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="ex">pcm.dmic_hw</span> {</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">    <span class="bu">type</span> hw</a>
<a class="sourceLine" id="cb1-7" data-line-number="7">    <span class="ex">card</span> sndrpisimplecar</a>
<a class="sourceLine" id="cb1-8" data-line-number="8">    <span class="ex">channels</span> 2</a>
<a class="sourceLine" id="cb1-9" data-line-number="9">    <span class="ex">format</span> S32_LE</a>
<a class="sourceLine" id="cb1-10" data-line-number="10">}</a>
<a class="sourceLine" id="cb1-11" data-line-number="11"></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="co">#This is the software volume control, it links to the hardware above and after</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="co"># saving the .asoundrc file you can type alsamixer, press F6 to select</span></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="co"># your I2S mic then F4 to set the recording volume and arrow up and down</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="co"># to adjust the volume</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"><span class="co"># After adjusting the volume - go for 50 percent at first, you can do</span></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="co"># something like</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="co"># arecord -D dmic_sv -c2 -r 48000 -f S32_LE -t wav -V mono -v myfile.wav</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="ex">pcm.dmic_sv</span> {</a>
<a class="sourceLine" id="cb1-20" data-line-number="20">    <span class="bu">type</span> softvol</a>
<a class="sourceLine" id="cb1-21" data-line-number="21">    <span class="ex">slave.pcm</span> dmic_hw</a>
<a class="sourceLine" id="cb1-22" data-line-number="22">    <span class="ex">control</span> {</a>
<a class="sourceLine" id="cb1-23" data-line-number="23">        <span class="ex">name</span> <span class="st">&quot;Boost Capture Volume&quot;</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24">        <span class="ex">card</span> sndrpisimplecar</a>
<a class="sourceLine" id="cb1-25" data-line-number="25">    }</a>
<a class="sourceLine" id="cb1-26" data-line-number="26">    <span class="ex">min_dB</span> -3.0</a>
<a class="sourceLine" id="cb1-27" data-line-number="27">    <span class="ex">max_dB</span> 30.0</a>
<a class="sourceLine" id="cb1-28" data-line-number="28">}</a></code></pre></div>
<h2 id="software">Software</h2>
<p><strong>Not fully working</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode python"><code class="sourceCode python"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co">#!/usr/bin/env python2</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"></a>
<a class="sourceLine" id="cb2-3" data-line-number="3"><span class="im">import</span> pyaudio</a>
<a class="sourceLine" id="cb2-4" data-line-number="4"><span class="im">import</span> wave</a>
<a class="sourceLine" id="cb2-5" data-line-number="5"></a>
<a class="sourceLine" id="cb2-6" data-line-number="6">INDEX <span class="op">=</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb2-7" data-line-number="7">CHUNK <span class="op">=</span> <span class="dv">1024</span></a>
<a class="sourceLine" id="cb2-8" data-line-number="8">FORMAT <span class="op">=</span> pyaudio.paInt16</a>
<a class="sourceLine" id="cb2-9" data-line-number="9">CHANNELS <span class="op">=</span> <span class="dv">2</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">RATE <span class="op">=</span> <span class="dv">44100</span></a>
<a class="sourceLine" id="cb2-11" data-line-number="11">RECORD_SECONDS <span class="op">=</span> <span class="dv">5</span></a>
<a class="sourceLine" id="cb2-12" data-line-number="12">WAVE_OUTPUT_FILENAME <span class="op">=</span> <span class="st">&quot;output.wav&quot;</span></a>
<a class="sourceLine" id="cb2-13" data-line-number="13"></a>
<a class="sourceLine" id="cb2-14" data-line-number="14">p <span class="op">=</span> pyaudio.PyAudio()</a>
<a class="sourceLine" id="cb2-15" data-line-number="15"></a>
<a class="sourceLine" id="cb2-16" data-line-number="16"><span class="bu">print</span> <span class="st">&#39;Using:&#39;</span>, p.get_device_info_by_host_api_device_index(<span class="dv">0</span>, INDEX)[<span class="st">&#39;name&#39;</span>]</a>
<a class="sourceLine" id="cb2-17" data-line-number="17"></a>
<a class="sourceLine" id="cb2-18" data-line-number="18">stream <span class="op">=</span> p.<span class="bu">open</span>(<span class="bu">format</span><span class="op">=</span>FORMAT,</a>
<a class="sourceLine" id="cb2-19" data-line-number="19">                channels<span class="op">=</span>CHANNELS,</a>
<a class="sourceLine" id="cb2-20" data-line-number="20">                rate<span class="op">=</span>RATE,</a>
<a class="sourceLine" id="cb2-21" data-line-number="21">                <span class="bu">input</span><span class="op">=</span><span class="va">True</span>,</a>
<a class="sourceLine" id="cb2-22" data-line-number="22">                input_device_index<span class="op">=</span>INDEX,</a>
<a class="sourceLine" id="cb2-23" data-line-number="23">                frames_per_buffer<span class="op">=</span>CHUNK)</a>
<a class="sourceLine" id="cb2-24" data-line-number="24"></a>
<a class="sourceLine" id="cb2-25" data-line-number="25"><span class="bu">print</span>(<span class="st">&quot;* recording&quot;</span>)</a>
<a class="sourceLine" id="cb2-26" data-line-number="26"></a>
<a class="sourceLine" id="cb2-27" data-line-number="27">frames <span class="op">=</span> []</a>
<a class="sourceLine" id="cb2-28" data-line-number="28"></a>
<a class="sourceLine" id="cb2-29" data-line-number="29"><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, <span class="bu">int</span>(RATE <span class="op">/</span> CHUNK <span class="op">*</span> RECORD_SECONDS)):</a>
<a class="sourceLine" id="cb2-30" data-line-number="30">    data <span class="op">=</span> stream.read(CHUNK)</a>
<a class="sourceLine" id="cb2-31" data-line-number="31">    frames.append(data)</a>
<a class="sourceLine" id="cb2-32" data-line-number="32"></a>
<a class="sourceLine" id="cb2-33" data-line-number="33"><span class="bu">print</span>(<span class="st">&quot;* done recording&quot;</span>)</a>
<a class="sourceLine" id="cb2-34" data-line-number="34"></a>
<a class="sourceLine" id="cb2-35" data-line-number="35">stream.stop_stream()</a>
<a class="sourceLine" id="cb2-36" data-line-number="36">stream.close()</a>
<a class="sourceLine" id="cb2-37" data-line-number="37">p.terminate()</a>
<a class="sourceLine" id="cb2-38" data-line-number="38"></a>
<a class="sourceLine" id="cb2-39" data-line-number="39">wf <span class="op">=</span> wave.<span class="bu">open</span>(WAVE_OUTPUT_FILENAME, <span class="st">&#39;wb&#39;</span>)</a>
<a class="sourceLine" id="cb2-40" data-line-number="40">wf.setnchannels(CHANNELS)</a>
<a class="sourceLine" id="cb2-41" data-line-number="41">wf.setsampwidth(p.get_sample_size(FORMAT))</a>
<a class="sourceLine" id="cb2-42" data-line-number="42">wf.setframerate(RATE)</a>
<a class="sourceLine" id="cb2-43" data-line-number="43">wf.writeframes(b<span class="st">&#39;&#39;</span>.join(frames))</a>
<a class="sourceLine" id="cb2-44" data-line-number="44">wf.close()</a></code></pre></div>
<h1 id="references">References</h1>
<ul>
<li><a href="https://learn.adafruit.com/adafruit-i2s-mems-microphone-breakout?view=all">Adafruit Tutorial</a></li>
</ul>

            
          </div>

        </div>
    </body>

    <div id="footer-wrapper">

  <div class="logo"></div>

  <div class="logo">
    <a class="logo" href="http://github.com/walchko"><i class="fl-github fl-36"></i></a>
    <a class="logo" href="http://stackoverflow.com/users/5374768/kevin"><i class="fl-stackoverflow fl-36"></i></a>
    <a class="logo" href="http://raspberrypi.stackexchange.com/users/1677/kevin"><i class="fl-stackexchange fl-36"></i></a>
    <a class="logo" href="https://www.npmjs.com/~kevin.walchko"><i class="fl-npm fl-36"></i></a>
    <a class="logo" href="https://pypi.python.org/pypi"><i class="fl-python fl-36"></i></a>
    <a class="logo" href="https://bitbucket.org/walchko/"><i class="fl-bitbucket fl-36"></i></a>
  </div>

  <div class="logo">
    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">
      <i class="cc cc-by-sa cc-lg"></i>
    </a>
  </div>

  <div class="pure-u-1">
    <a class="logo" href="https://github.com/walchko/pelican">&copy;&nbsp;2016&nbsp;Kevin J. Walchko</a>
  </div>

</div>


</html>
